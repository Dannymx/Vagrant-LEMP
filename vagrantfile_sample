def Kernel.is_windows
    processor, platform, *rest = RUBY_PLATFORM.split("-")
    platform == "mingw32"
end

Vagrant::Config.run do |config|
    config.vm.box     = "squeeze64puppet3"
    config.vm.box_url = "http://l4bs.slynett.com/vagrant/squeeze64-puppet3.box"
    
    config.vm.customize [ "modifyvm", :id, "--name", "devstation" ]
    config.vm.customize [ "modifyvm", :id, "--memory", "1024", "--cpus", "1" ]

    config.vm.network :forwarded_port, guest: 80, host: 8080
    config.vm.network :hostonly, "11.11.11.11"
    config.vm.host_name = "devstation"

    config.vm.share_folder "vagrant", "/vagrant", "."
    config.vm.share_folder "project", "/var/www/sites", "./sites", :nfs => !Kernel.is_windows, :create => true, :remount => true

    config.vm.provision :shell, :inline => "echo \"Europe/Paris\" | sudo tee /etc/timezone && dpkg-reconfigure --frontend noninteractive tzdata"

    # SERVER INSTALL
    config.vm.provision :shell, :path => "servers/apache.sh"
    #config.vm.provision :shell, :path => "servers/nginx.sh"
    
    # STUFF
    config.vm.provision :shell, :path => "bootstrap.sh"

    # DATABASE
    config.vm.provision :shell, :path => "databases/mysql.sh"
    #config.vm.provision :shell, :path => "databases/sqlite3.sh"
    #config.vm.provision :shell, :path => "databases/mongodb.sh"
end
